name: Test Secret Access

on:
  workflow_dispatch: # Manual trigger only

jobs:
  test-secrets:
    runs-on: self-hosted
    permissions:
      contents: read
      id-token: write

    steps:
    - name: Test organization secret access
      run: |
        echo "Testing access to organization secrets..."
        echo "PROJECT_ID length: ${#PROJECT_ID}"
        echo "PROJECT_NUMBER length: ${#PROJECT_NUMBER}"
        echo "NCI_USERNAME length: ${#NCI_USERNAME}"
        echo "NCI_PROJECT length: ${#NCI_PROJECT}"

        # Test if secrets are accessible (without revealing values)
        if [ -n "$PROJECT_ID" ]; then
          echo "✅ PROJECT_ID is accessible"
        else
          echo "❌ PROJECT_ID is not accessible"
        fi

        if [ -n "$PROJECT_NUMBER" ]; then
          echo "✅ PROJECT_NUMBER is accessible"
        else
          echo "❌ PROJECT_NUMBER is not accessible"
        fi

        if [ -n "$NCI_USERNAME" ]; then
          echo "✅ NCI_USERNAME is accessible"
        else
          echo "❌ NCI_USERNAME is not accessible"
        fi

        if [ -n "$NCI_PROJECT" ]; then
          echo "✅ NCI_PROJECT is accessible"
        else
          echo "❌ NCI_PROJECT is not accessible"
        fi
      env:
        PROJECT_ID: ${{ secrets.PROJECT_ID }}
        PROJECT_NUMBER: ${{ secrets.PROJECT_NUMBER }}
        NCI_USERNAME: ${{ secrets.NCI_USERNAME }}
        NCI_PROJECT: ${{ secrets.NCI_PROJECT }}
