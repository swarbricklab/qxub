# NCI Gadi Platform Definition
# This file describes Gadi's capabilities and lives ON the Gadi system
# Remote connection details are configured separately in user's ~/.config/qxub/config.yaml

platform:
  name: nci_gadi_remote
  type: pbs_pro
  host: gadi.nci.org.au  # Remote hostname for SSH connections
  description: "NCI Gadi supercomputer - for remote execution"

# Queue definitions - describe what this system can do
# These are universal and not user-specific
queues:
  normal:
    type: standard
    limits:
      max_cores: 48
      max_memory_gb: 192
      max_walltime: "48:00:00"
      max_jobs_per_user: 100
      max_jobs_queued: 1000
    priority: normal
    su_billing_rate: 1.0
    default_walltime: "1:00:00"
    walltime_rules:
      - cores: "1-48"
        max_walltime: "48:00:00"
      - cores: "49-144"
        max_walltime: "24:00:00"
      - cores: "145-240"
        max_walltime: "12:00:00"

  normalsl:
    type: standard
    limits:
      max_cores: 48
      max_memory_gb: 192
      max_walltime: "10:00:00"
      max_jobs_per_user: 20
    priority: high
    su_billing_rate: 2.0
    description: "Short-lived normal queue with higher priority"

  gpu:
    type: gpu
    limits:
      max_cores: 48
      max_memory_gb: 384
      max_gpus: 4
      max_walltime: "24:00:00"
      max_jobs_per_user: 10
      min_gpus: 1
    priority: high
    su_billing_rate: 3.0
    walltime_rules:
      - cores: "1-48"
        max_walltime: "24:00:00"

  hugemem:
    type: highmem
    limits:
      max_cores: 48
      max_memory_gb: 1400
      max_walltime: "48:00:00"
      min_memory_gb: 250
      max_jobs_per_user: 5
    priority: normal
    su_billing_rate: 1.5

# Auto-selection rules - determine best queue based on resource requirements
auto_selection:
  - condition: "gpus > 0"
    queue: gpu
  - condition: "memory_gb > 500"
    queue: hugemem
  - condition: "walltime_hours <= 10"
    queue: normalsl
  - condition: "cores <= 48"
    queue: normal
    is_default: true

# Queue efficiency adjustments - optimize resource allocation
auto_adjust:
  normal: "round_cores_to_multiple(cores, 4)"
  hugemem: "max(cores, 8)"
